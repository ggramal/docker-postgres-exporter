#!/bin/sh

export PG_EXPORTER_WEB_LISTEN_ADDRESS=${PG_EXPORTER_WEB_LISTEN_ADDRESS:-9187}
export PG_EXPORTER_COLLECTOR_DATABASE=${PG_EXPORTER_COLLECTOR_DATABASE:-false}
export PG_EXPORTER_COLLECTOR_DATABASE_WRAPAROUND=${PG_EXPORTER_COLLECTOR_DATABASE_WRAPAROUND:-false}
export PG_EXPORTER_COLLECTOR_LOCKS=${PG_EXPORTER_COLLECTOR_LOCKS:-false}
export PG_EXPORTER_COLLECTOR_LONG_RUNNING_TRANSACTIONS=${PG_EXPORTER_COLLECTOR_LONG_RUNNING_TRANSACTIONS:-false}
export PG_EXPORTER_COLLECTOR_POSTMASTER=${PG_EXPORTER_COLLECTOR_POSTMASTER:-false}
export PG_EXPORTER_COLLECTOR_PROCESS_IDLE=${PG_EXPORTER_COLLECTOR_PROCESS_IDLE:-false}
export PG_EXPORTER_COLLECTOR_REPLICATION=${PG_EXPORTER_COLLECTOR_REPLICATION:-false}
export PG_EXPORTER_COLLECTOR_REPLICATION_SLOT=${PG_EXPORTER_COLLECTOR_REPLICATION_SLOT:-false}
export PG_EXPORTER_COLLECTOR_STAT_ACTIVITY_AUTOVACUUM=${PG_EXPORTER_COLLECTOR_STAT_ACTIVITY_AUTOVACUUM:-false}
export PG_EXPORTER_COLLECTOR_STAT_BGWRITER=${PG_EXPORTER_COLLECTOR_STAT_BGWRITER:-false}
export PG_EXPORTER_COLLECTOR_STAT_DATABASE=${PG_EXPORTER_COLLECTOR_STAT_DATABASE:-false}
export PG_EXPORTER_COLLECTOR_STAT_STATEMENTS=${PG_EXPORTER_COLLECTOR_STAT_STATEMENTS:-false}
export PG_EXPORTER_COLLECTOR_STAT_USER_TABLES=${PG_EXPORTER_COLLECTOR_STAT_USER_TABLES:-false}
export PG_EXPORTER_COLLECTOR_STAT_WAL_RECEIVER=${PG_EXPORTER_COLLECTOR_STAT_WAL_RECEIVER:-false}
export PG_EXPORTER_COLLECTOR_STATIO_USER_INDEXES=${PG_EXPORTER_COLLECTOR_STATIO_USER_INDEXES:-false}
export PG_EXPORTER_COLLECTOR_STATIO_USER_TABLES=${PG_EXPORTER_COLLECTOR_STATIO_USER_TABLES:-false}
export PG_EXPORTER_COLLECTOR_WAL=${PG_EXPORTER_COLLECTOR_WAL:-false}
export PG_EXPORTER_COLLECTOR_XLOG_LOCATION=${PG_EXPORTER_COLLECTOR_XLOG_LOCATION:-false}
export PG_EXPORTER_DISABLE_SETTINGS_METRICS=${PG_EXPORTER_DISABLE_SETTINGS_METRICS:-true}

PG_EXPORTER_ARGS="--web.listen-address=:${PG_EXPORTER_WEB_LISTEN_ADDRESS}"

[[ $PG_EXPORTER_COLLECTOR_DATABASE == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.database" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.database"
[[ $PG_EXPORTER_COLLECTOR_DATABASE_WRAPAROUND == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.database_wraparound" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.database_wraparound"
[[ $PG_EXPORTER_COLLECTOR_LOCKS == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.locks" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.locks"
[[ $PG_EXPORTER_COLLECTOR_LONG_RUNNING_TRANSACTIONS == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.long_running_transactions" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.long_running_transactions"
[[ $PG_EXPORTER_COLLECTOR_POSTMASTER == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.postmaster" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.postmaster"
[[ $PG_EXPORTER_COLLECTOR_PROCESS_IDLE == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.process_idle" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.process_idle"
[[ $PG_EXPORTER_COLLECTOR_REPLICATION == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.replication" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.replication"
[[ $PG_EXPORTER_COLLECTOR_REPLICATION_SLOT == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.replication_slot" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.replication_slot"
[[ $PG_EXPORTER_COLLECTOR_STAT_ACTIVITY_AUTOVACUUM == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.stat_activity_autovacuum" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.stat_activity_autovacuum"
[[ $PG_EXPORTER_COLLECTOR_STAT_BGWRITER == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.stat_bgwriter" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.stat_bgwriter"
[[ $PG_EXPORTER_COLLECTOR_STAT_DATABASE == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.stat_database" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.stat_database"
[[ $PG_EXPORTER_COLLECTOR_STAT_STATEMENTS == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.stat_statements" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.stat_statements"
[[ $PG_EXPORTER_COLLECTOR_STAT_USER_TABLES == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.stat_user_tables" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.stat_user_tables"
[[ $PG_EXPORTER_COLLECTOR_STAT_WAL_RECEIVER == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.stat_wal_receiver" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.stat_wal_receiver"
[[ $PG_EXPORTER_COLLECTOR_STATIO_USER_INDEXES == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.statio_user_indexes" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.statio_user_indexes"
[[ $PG_EXPORTER_COLLECTOR_STATIO_USER_TABLES == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.statio_user_tables" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.statio_user_tables"
[[ $PG_EXPORTER_COLLECTOR_WAL == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.wal" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.wal"
[[ $PG_EXPORTER_COLLECTOR_XLOG_LOCATION == true ]] && PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --collector.xlog_location" || PG_EXPORTER_ARGS="$PG_EXPORTER_ARGS --no-collector.xlog_location"

exec /bin/postgres_exporter $PG_EXPORTER_ARGS
